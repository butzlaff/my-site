{"ast":null,"code":"'use strict';\n\nconst Packet = require('../packets/packet');\n\nconst ClientConstants = require('../constants/client.js'); // https://dev.mysql.com/doc/internals/en/connection-phase-packets.html#packet-Protocol::Handshake\n\n\nclass Handshake {\n  constructor(args) {\n    this.protocolVersion = args.protocolVersion;\n    this.serverVersion = args.serverVersion;\n    this.capabilityFlags = args.capabilityFlags;\n    this.connectionId = args.connectionId;\n    this.authPluginData1 = args.authPluginData1;\n    this.authPluginData2 = args.authPluginData2;\n    this.characterSet = args.characterSet;\n    this.statusFlags = args.statusFlags;\n    this.autPluginName = args.autPluginName;\n  }\n\n  setScrambleData(cb) {\n    require('crypto').randomBytes(20, (err, data) => {\n      if (err) {\n        cb(err);\n        return;\n      }\n\n      this.authPluginData1 = data.slice(0, 8);\n      this.authPluginData2 = data.slice(8, 20);\n      cb();\n    });\n  }\n\n  toPacket(sequenceId) {\n    const length = 68 + Buffer.byteLength(this.serverVersion, 'utf8');\n    const buffer = Buffer.alloc(length + 4, 0); // zero fill, 10 bytes filler later needs to contain zeros\n\n    const packet = new Packet(sequenceId, buffer, 0, length + 4);\n    packet.offset = 4;\n    packet.writeInt8(this.protocolVersion);\n    packet.writeString(this.serverVersion, 'cesu8');\n    packet.writeInt8(0);\n    packet.writeInt32(this.connectionId);\n    packet.writeBuffer(this.authPluginData1);\n    packet.writeInt8(0);\n    const capabilityFlagsBuffer = Buffer.allocUnsafe(4);\n    capabilityFlagsBuffer.writeUInt32LE(this.capabilityFlags, 0);\n    packet.writeBuffer(capabilityFlagsBuffer.slice(0, 2));\n    packet.writeInt8(this.characterSet);\n    packet.writeInt16(this.statusFlags);\n    packet.writeBuffer(capabilityFlagsBuffer.slice(2, 4));\n    packet.writeInt8(21); // authPluginDataLength\n\n    packet.skip(10);\n    packet.writeBuffer(this.authPluginData2);\n    packet.writeInt8(0);\n    packet.writeString('mysql_native_password', 'latin1');\n    packet.writeInt8(0);\n    return packet;\n  }\n\n  static fromPacket(packet) {\n    const args = {};\n    args.protocolVersion = packet.readInt8();\n    args.serverVersion = packet.readNullTerminatedString('cesu8');\n    args.connectionId = packet.readInt32();\n    args.authPluginData1 = packet.readBuffer(8);\n    packet.skip(1);\n    const capabilityFlagsBuffer = Buffer.allocUnsafe(4);\n    capabilityFlagsBuffer[0] = packet.readInt8();\n    capabilityFlagsBuffer[1] = packet.readInt8();\n\n    if (packet.haveMoreData()) {\n      args.characterSet = packet.readInt8();\n      args.statusFlags = packet.readInt16(); // upper 2 bytes\n\n      capabilityFlagsBuffer[2] = packet.readInt8();\n      capabilityFlagsBuffer[3] = packet.readInt8();\n      args.capabilityFlags = capabilityFlagsBuffer.readUInt32LE(0);\n\n      if (args.capabilityFlags & ClientConstants.PLUGIN_AUTH) {\n        args.authPluginDataLength = packet.readInt8();\n      } else {\n        args.authPluginDataLength = 0;\n        packet.skip(1);\n      }\n\n      packet.skip(10);\n    } else {\n      args.capabilityFlags = capabilityFlagsBuffer.readUInt16LE(0);\n    }\n\n    const isSecureConnection = args.capabilityFlags & ClientConstants.SECURE_CONNECTION;\n\n    if (isSecureConnection) {\n      const authPluginDataLength = args.authPluginDataLength;\n\n      if (authPluginDataLength === 0) {\n        // for Secure Password Authentication\n        args.authPluginDataLength = 20;\n        args.authPluginData2 = packet.readBuffer(12);\n        packet.skip(1);\n      } else {\n        // length > 0\n        // for Custom Auth Plugin (PLUGIN_AUTH)\n        const len = Math.max(13, authPluginDataLength - 8);\n        args.authPluginData2 = packet.readBuffer(len);\n      }\n    }\n\n    if (args.capabilityFlags & ClientConstants.PLUGIN_AUTH) {\n      args.autPluginName = packet.readNullTerminatedString('ascii');\n    }\n\n    return new Handshake(args);\n  }\n\n}\n\nmodule.exports = Handshake;","map":{"version":3,"names":["Packet","require","ClientConstants","Handshake","constructor","args","protocolVersion","serverVersion","capabilityFlags","connectionId","authPluginData1","authPluginData2","characterSet","statusFlags","autPluginName","setScrambleData","cb","randomBytes","err","data","slice","toPacket","sequenceId","length","Buffer","byteLength","buffer","alloc","packet","offset","writeInt8","writeString","writeInt32","writeBuffer","capabilityFlagsBuffer","allocUnsafe","writeUInt32LE","writeInt16","skip","fromPacket","readInt8","readNullTerminatedString","readInt32","readBuffer","haveMoreData","readInt16","readUInt32LE","PLUGIN_AUTH","authPluginDataLength","readUInt16LE","isSecureConnection","SECURE_CONNECTION","len","Math","max","module","exports"],"sources":["/home/emilio/Ãrea de Trabalho/OneBitCode-aulas/REACT/site-react-login-live/react-controlledForms/node_modules/mysql2/lib/packets/handshake.js"],"sourcesContent":["'use strict';\n\nconst Packet = require('../packets/packet');\nconst ClientConstants = require('../constants/client.js');\n\n// https://dev.mysql.com/doc/internals/en/connection-phase-packets.html#packet-Protocol::Handshake\n\nclass Handshake {\n  constructor(args) {\n    this.protocolVersion = args.protocolVersion;\n    this.serverVersion = args.serverVersion;\n    this.capabilityFlags = args.capabilityFlags;\n    this.connectionId = args.connectionId;\n    this.authPluginData1 = args.authPluginData1;\n    this.authPluginData2 = args.authPluginData2;\n    this.characterSet = args.characterSet;\n    this.statusFlags = args.statusFlags;\n    this.autPluginName = args.autPluginName;\n  }\n\n  setScrambleData(cb) {\n    require('crypto').randomBytes(20, (err, data) => {\n      if (err) {\n        cb(err);\n        return;\n      }\n      this.authPluginData1 = data.slice(0, 8);\n      this.authPluginData2 = data.slice(8, 20);\n      cb();\n    });\n  }\n\n  toPacket(sequenceId) {\n    const length = 68 + Buffer.byteLength(this.serverVersion, 'utf8');\n    const buffer = Buffer.alloc(length + 4, 0); // zero fill, 10 bytes filler later needs to contain zeros\n    const packet = new Packet(sequenceId, buffer, 0, length + 4);\n    packet.offset = 4;\n    packet.writeInt8(this.protocolVersion);\n    packet.writeString(this.serverVersion, 'cesu8');\n    packet.writeInt8(0);\n    packet.writeInt32(this.connectionId);\n    packet.writeBuffer(this.authPluginData1);\n    packet.writeInt8(0);\n    const capabilityFlagsBuffer = Buffer.allocUnsafe(4);\n    capabilityFlagsBuffer.writeUInt32LE(this.capabilityFlags, 0);\n    packet.writeBuffer(capabilityFlagsBuffer.slice(0, 2));\n    packet.writeInt8(this.characterSet);\n    packet.writeInt16(this.statusFlags);\n    packet.writeBuffer(capabilityFlagsBuffer.slice(2, 4));\n    packet.writeInt8(21); // authPluginDataLength\n    packet.skip(10);\n    packet.writeBuffer(this.authPluginData2);\n    packet.writeInt8(0);\n    packet.writeString('mysql_native_password', 'latin1');\n    packet.writeInt8(0);\n    return packet;\n  }\n\n  static fromPacket(packet) {\n    const args = {};\n    args.protocolVersion = packet.readInt8();\n    args.serverVersion = packet.readNullTerminatedString('cesu8');\n    args.connectionId = packet.readInt32();\n    args.authPluginData1 = packet.readBuffer(8);\n    packet.skip(1);\n    const capabilityFlagsBuffer = Buffer.allocUnsafe(4);\n    capabilityFlagsBuffer[0] = packet.readInt8();\n    capabilityFlagsBuffer[1] = packet.readInt8();\n    if (packet.haveMoreData()) {\n      args.characterSet = packet.readInt8();\n      args.statusFlags = packet.readInt16();\n      // upper 2 bytes\n      capabilityFlagsBuffer[2] = packet.readInt8();\n      capabilityFlagsBuffer[3] = packet.readInt8();\n      args.capabilityFlags = capabilityFlagsBuffer.readUInt32LE(0);\n      if (args.capabilityFlags & ClientConstants.PLUGIN_AUTH) {\n        args.authPluginDataLength = packet.readInt8();\n      } else {\n        args.authPluginDataLength = 0;\n        packet.skip(1);\n      }\n      packet.skip(10);\n    } else {\n      args.capabilityFlags = capabilityFlagsBuffer.readUInt16LE(0);\n    }\n\n    const isSecureConnection =\n      args.capabilityFlags & ClientConstants.SECURE_CONNECTION;\n    if (isSecureConnection) {\n      const authPluginDataLength = args.authPluginDataLength;\n      if (authPluginDataLength === 0) {\n        // for Secure Password Authentication\n        args.authPluginDataLength = 20;\n        args.authPluginData2 = packet.readBuffer(12);\n        packet.skip(1);\n      } else {\n        // length > 0\n        // for Custom Auth Plugin (PLUGIN_AUTH)\n        const len = Math.max(13, authPluginDataLength - 8);\n        args.authPluginData2 = packet.readBuffer(len);\n      }\n    }\n\n    if (args.capabilityFlags & ClientConstants.PLUGIN_AUTH) {\n      args.autPluginName = packet.readNullTerminatedString('ascii');\n    }\n\n    return new Handshake(args);\n  }\n}\n\nmodule.exports = Handshake;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}